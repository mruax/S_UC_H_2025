{% extends 'base.html' %}

{% block title %}–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –æ–±—É—á–µ–Ω–∏—è{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
    <div>
        <h1>–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –æ–±—É—á–µ–Ω–∏—è</h1>
        <p style="font-size: 18px; color: #86868b;">–õ–∏—á–Ω—ã–µ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏</p>
    </div>
    <a href="{% url 'create_trajectory' %}" class="btn">+ –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é</a>
</div>

{% if all_trajectories %}
<h2 style="margin-bottom: 20px;">–í–∞—à–∏ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏</h2>
<div class="grid">
    {% for traj in all_trajectories %}
    <div class="card" style="position: relative; padding-bottom: 60px;">
        <a href="{% url 'trajectory' traj.id %}" style="text-decoration: none; color: inherit;">
            <div style="cursor: pointer;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                    <h3 style="font-size: 18px; margin: 0; flex: 1; margin-right: 10px;">{{ traj.name }}</h3>
                    <span style="font-size: 10px; background: {% if traj.trajectory_type == 'personal' %}#000{% else %}#666{% endif %}; color: #fff; padding: 4px 8px; border-radius: 4px; white-space: nowrap;">
                        {% if traj.trajectory_type == 'personal' %}–õ–∏—á–Ω–∞—è{% else %}–û—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è{% endif %}
                    </span>
                </div>
                <p style="font-size: 12px; color: #86868b;">{{ traj.courses.count }} –∫—É—Ä—Å–æ–≤</p>
                {% if traj.teacher %}
                <p style="font-size: 12px; color: #86868b; margin-top: 8px;">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: {{ traj.teacher.username }}</p>
                {% endif %}
            </div>
        </a>
        
        <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É -->
        <form method="post" action="{% url 'delete_trajectory' traj.id %}" style="position: absolute; bottom: 15px; right: 15px;">
            {% csrf_token %}
            <button type="submit" style="background: #000; border: none; cursor: pointer; font-size: 14px; color: #fff; width: 30px; height: 30px; border-radius: 4px; display: flex; align-items: center; justify-content: center;" 
                    onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é \"{{ traj.name }}\"?')">
                üóëÔ∏è
            </button>
        </form>
    </div>
    {% endfor %}
</div>
{% else %}
<div style="text-align: center; padding: 60px 0;">
    <p style="font-size: 18px; color: #86868b; margin-bottom: 20px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π</p>
    <a href="{% url 'create_trajectory' %}" class="btn">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é</a>
</div>
{% endif %}

{% if trajectory %}
<div style="margin-top: 60px;">
    <h2 style="margin-bottom: 20px;">{{ trajectory.name }}</h2>
    
    {% if trajectory_courses %}
    <div style="display: flex; flex-direction: column; gap: 15px;">
        {% for tc in trajectory_courses %}
        <a href="{% url 'course' tc.course.id %}" style="text-decoration: none; color: inherit;">
            <div class="card" style="display: flex; align-items: center; gap: 20px; cursor: pointer;">
                <div style="min-width: 40px; height: 40px; background: #000; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                    {{ forloop.counter }}
                </div>
                <div style="flex: 1;">
                    <h3 style="font-size: 16px; margin-bottom: 4px;">{{ tc.course.title }}</h3>
                    <p style="font-size: 12px; color: #86868b;">{{ tc.course.category }} ‚Ä¢ {{ tc.course.duration_hours }} —á–∞—Å–æ–≤</p>
                </div>
                <div style="min-width: 120px; text-align: right;">
                    <div style="width: 100%; height: 6px; background: #f5f5f7; border-radius: 3px; overflow: hidden;">
                        <div style="width: {{ tc.progress }}%; height: 100%; background: #000; transition: width 0.3s;"></div>
                    </div>
                    <p style="font-size: 11px; color: #86868b; margin-top: 4px;">{{ tc.progress }}%</p>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <p style="color: #86868b;">–í —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –∫—É—Ä—Å–æ–≤</p>
    {% endif %}
</div>
{% endif %}
{% endblock %}